{% comment %}
  Sección: Bundle Offer Premium
  Lógica: Descuento dinámico del 15% por suscripción y selección de variantes.
{% endcomment %}

<section class="bundle-offer-container" style="background-color: {{ section.settings.bg_color }};">
  <div class="bundle-wrapper">
    
    <div class="bundle-reviews">
      <span class="stars">★★★★★</span> 4.8 estrellas de review | + 3,550 Orders Delivered
    </div>

    <h1 class="product-title">ALPPINO</h1>

    <div class="main-pricing">
      <span id="compare-price-display" class="compare-price">$89.99</span>
      <span id="current-price-display" class="current-price">$69.99</span>
    </div>

    <div class="bundle-description">
      <ul>
        <li>{{ section.settings.desc_1 }}</li>
        <li>{{ section.settings.desc_2 }}</li>
        <li>{{ section.settings.desc_3 }}</li>
      </ul>
    </div>

    <div class="divider">
      <span>{{ section.settings.divider_text }}</span>
    </div>

    <div class="option-row subscription-option">
      <label class="radio-container">
        <input type="checkbox" id="subscribe-checkbox">
        <span class="checkmark"></span>
        <span class="option-text">Subscribe & Save 15%</span>
      </label>
    </div>

    <div class="option-row bundle-option selected" data-base-price="69.99" data-compare="89.99" data-variant-id="{{ section.settings.variant_id_1 }}">
      <label class="radio-container">
        <input type="radio" name="bundle-select" checked>
        <span class="checkmark"></span>
        <div class="option-info">
          <span class="option-title">Buy 1 <span class="free-shipping">FREE SHIPPING</span></span>
          <div class="option-prices">
            <span class="opt-current">$69.99</span>
            <span class="opt-compare">$89.99</span>
          </div>
        </div>
      </label>
    </div>

    <div class="option-row bundle-option" data-base-price="124.99" data-compare="179.98" data-variant-id="{{ section.settings.variant_id_2 }}">
      <div class="badge-popular">MOST POPULAR</div>
      <label class="radio-container">
        <input type="radio" name="bundle-select">
        <span class="checkmark"></span>
        <div class="option-info">
          <span class="option-title">Buy 2 <span class="free-shipping">FREE SHIPPING</span></span>
          <div class="option-prices">
            <span class="opt-current">$124.99</span>
            <span class="opt-compare">$179.98</span>
          </div>
        </div>
      </label>
    </div>

    <button id="bundle-add-to-cart" class="add-to-cart-btn">
      ADD TO CART
    </button>

    <div class="payment-methods">
      <img src="https://cdn.shopify.com/s/files/1/0000/0000/files/visa.svg" alt="Visa" width="40">
      <img src="https://cdn.shopify.com/s/files/1/0000/0000/files/mastercard.svg" alt="Mastercard" width="40">
      <img src="https://cdn.shopify.com/s/files/1/0000/0000/files/amex.svg" alt="Amex" width="40">
      <img src="https://cdn.shopify.com/s/files/1/0000/0000/files/paypal.svg" alt="Paypal" width="40">
      <img src="https://cdn.shopify.com/s/files/1/0000/0000/files/apple-pay.svg" alt="Apple Pay" width="40">
    </div>

  </div>
</section>

<style>
  /* CSS Estilo Premium */
  .bundle-offer-container { font-family: 'Helvetica Neue', Arial, sans-serif; padding: 40px 20px; color: #1a1a1a; }
  .bundle-wrapper { max-width: 450px; margin: 0 auto; border: 1px solid #e1e1e1; padding: 25px; border-radius: 8px; background: #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
  .bundle-reviews { font-size: 13px; text-align: center; color: #4a4a4a; margin-bottom: 15px; }
  .stars { color: #ffb400; }
  .product-title { font-size: 32px; font-weight: 800; text-align: center; letter-spacing: 2px; margin: 10px 0; text-transform: uppercase; }
  .main-pricing { text-align: center; margin-bottom: 20px; }
  .compare-price { text-decoration: line-through; color: #999; margin-right: 10px; font-size: 18px; }
  .current-price { font-size: 24px; font-weight: bold; color: #d0021b; }
  .bundle-description ul { list-style: none; padding: 0; margin: 20px 0; font-size: 15px; line-height: 1.6; color: #555; }
  .divider { border-bottom: 2px solid #1a1a1a; text-align: center; height: 12px; margin: 30px 0; }
  .divider span { background: #fff; padding: 0 15px; font-weight: bold; font-size: 14px; text-transform: uppercase; }
  
  .option-row { border: 1px solid #ddd; padding: 15px; border-radius: 6px; margin-bottom: 12px; position: relative; cursor: pointer; transition: 0.3s; }
  .option-row.selected { border: 2px solid #1a1a1a; background: #f9f9f9; }
  .badge-popular { position: absolute; top: -10px; right: 10px; background: #1a1a1a; color: #fff; font-size: 10px; padding: 3px 10px; border-radius: 20px; font-weight: bold; }
  
  .free-shipping { margin-left: 5px; font-size: 11px; font-weight: bold; color: #27ae60; text-transform: uppercase; }
  .option-prices { margin-left: auto; text-align: right; display: flex; flex-direction: column; }
  .opt-current { font-weight: bold; font-size: 16px; }
  .opt-compare { font-size: 12px; color: #999; text-decoration: line-through; }
  
  .add-to-cart-btn { width: 100%; background: #1a1a1a; color: #fff; border: none; padding: 18px; font-size: 16px; font-weight: bold; border-radius: 4px; cursor: pointer; margin-top: 20px; transition: background 0.3s; }
  .add-to-cart-btn:hover { background: #333; }
  .payment-methods { display: flex; justify-content: center; gap: 10px; margin-top: 20px; opacity: 0.7; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const checkbox = document.getElementById('subscribe-checkbox');
  const bundleOptions = document.querySelectorAll('.bundle-option');
  const mainCurrent = document.getElementById('current-price-display');
  const mainCompare = document.getElementById('compare-price-display');
  const atcButton = document.getElementById('bundle-add-to-cart');

  function updatePrices() {
    let selectedOption = document.querySelector('.bundle-option.selected');
    let isSubscribed = checkbox.checked;
    let basePrice = parseFloat(selectedOption.dataset.basePrice);
    let comparePrice = parseFloat(selectedOption.dataset.compare);

    if (isSubscribed) {
      basePrice = (basePrice * 0.85).toFixed(2); // Rebaja el 15%
    }

    mainCurrent.innerText = '$' + basePrice;
    mainCompare.innerText = '$' + comparePrice;
    
    // Actualizar precios visuales en las filas
    bundleOptions.forEach(opt => {
      let optBase = parseFloat(opt.dataset.basePrice);
      if (isSubscribed) optBase = (optBase * 0.85).toFixed(2);
      opt.querySelector('.opt-current').innerText = '$' + optBase;
    });
  }

  bundleOptions.forEach(option => {
    option.addEventListener('click', function() {
      bundleOptions.forEach(o => o.classList.remove('selected'));
      this.classList.add('selected');
      this.querySelector('input').checked = true;
      updatePrices();
    });
  });

  checkbox.addEventListener('change', updatePrices);

  atcButton.addEventListener('click', function() {
    let selected = document.querySelector('.bundle-option.selected');
    let variantId = selected.dataset.variantId;
    
    // Lógica para agregar al carrito de Shopify vía AJAX
    fetch('/cart/add.js', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ items: [{ id: variantId, quantity: 1 }] })
    }).then(response => {
      window.location.href = '/cart'; // Lleva directamente al carrito
    });
  });
});
</script>

{% schema %}
{
  "name": "Bundle Offer Premium",
  "settings": [
    { "type": "color", "id": "bg_color", "label": "Background Color", "default": "#ffffff" },
    { "type": "text", "id": "divider_text", "label": "Divider Text", "default": "GET YOURS" },
    { "type": "text", "id": "desc_1", "label": "Desc 1", "default": "Premium High Quality Material" },
    { "type": "text", "id": "desc_2", "label": "Desc 2", "default": "Ergonomic Design for Comfort" },
    { "type": "text", "id": "desc_3", "label": "Desc 3", "default": "30-Day Money Back Guarantee" },
    { "type": "text", "id": "variant_id_1", "label": "Shopify Variant ID Buy 1" },
    { "type": "text", "id": "variant_id_2", "label": "Shopify Variant ID Buy 2" }
  ]
}
{% endschema %}
